!function(){"use strict";!function(){class e{constructor(e){this.element=e}appendChild(e){this.element.appendChild(e)}appendComponent(e){this.appendChild(e.render())}appendNode(e){this.appendChild(e.element)}finalize(){return this.element}}class t extends e{constructor(e){e??=document.createElement("div"),super(e)}render(){}}function s(e){const t=Math.floor(4026531839*Math.random()+16**7);return`${e}-${Math.floor(t).toString(16)}`}class r extends t{render(){return this.element.classList.add("flex-break"),this.element}}class i extends t{constructor(){super(),this.element.id="about-modal"}render(){const e=document.createElement("div");e.classList.add("materialCard");const t=document.createElement("p");t.innerText="Calculate your tp per hit with this tool. Input your haste+% into the first grid of boxes, and your Store TP+ into the second grid. The sidebar will update with your overall haste percentage and tp per hit.";const s=document.createElement("button");s.classList.add("styledButton"),s.innerText="Close",s.addEventListener("click",i.closeModal);const n=document.createElement("p");n.classList.add("title-text"),n.innerText="About";const a=document.createElement("div");return a.classList.add("flexContainer","horizontal","center","titlebar"),a.appendChild(n),a.appendChild(s),e.appendChild(a),e.appendChild((new r).render()),e.appendChild(t),this.appendChild(e),this.finalize()}static closeModal(){document.getElementById("about-modal").classList.remove("active")}}class n extends t{LINKEDIN_URL="https://www.linkedin.com/in/christopher-trent-95b581190/";GITHUB_URL="https://github.com/ChristopherJTrent";constructor(){super(),this.element.id="header",this.element.classList.add("flexContainer","horizontal","center")}render(){const e=document.createElement("img");e.setAttribute("src","icon.webp"),e.classList.add("brand-icon"),this.element.appendChild(e);const t=document.createElement("p");t.classList.add("title-text"),t.innerText="Magian Calc",this.appendChild(t);const s=document.createElement("span");s.classList.add("flexCenter");const r=document.createElement("button");r.addEventListener("click",n.aboutModalHandler),r.setAttribute("value","About this tool"),r.innerText="About this tool",r.classList.add("styledButton"),s.appendChild(r),this.appendChild(s);const i=document.createElement("span");return i.classList.add("flexRight","socials"),i.appendChild(this.linkedin()),i.appendChild(this.github()),this.appendChild(i),this.finalize()}linkedin(){const e=document.createElement("a"),t=document.createElement("i");return t.classList.add("fa-brands","fa-linkedin"),e.setAttribute("href",this.LINKEDIN_URL),e.appendChild(t),e}github(){const e=document.createElement("a"),t=document.createElement("i");return t.classList.add("fa-brands","fa-github"),e.setAttribute("href",this.GITHUB_URL),e.appendChild(t),e}static aboutModalHandler(e){e.stopPropagation(),document.getElementById("about-modal").classList.add("active")}}function a(e){return e.reduce(((e,t)=>e+t),0)}class d{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.value=e,this.subscribers=[]}subscribe(e){this.subscribers.push(e),e(this.value)}setValue(e){return this.value=e,this.alertSubscribers(),!0}updateValue(e){return this.value=e(this.value),this.alertSubscribers(),!0}alertSubscribers(){for(const e of this.subscribers)e(this.value)}}class l extends d{static DEFAULT_AGGREGATOR=a;constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.value=e,this.subscribers=[],this.defaultAggregation=a}setDefaultAggregation(e){return this.defaultAggregation=e,this}setValueAtIndex(e,t){if(e>this.value.length-1){const t=e-this.value.length;this.value=this.value.concat(Array(t).fill(0))}this.value[e]=t,this.alertSubscribers()}subscribeAggregate(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.defaultAggregation;this.subscribe((()=>{e(t(this.value))}))}}class o extends d{constructor(e,t){if(this.allowedValues=e,!this.allowedValues.includes(t))throw new Error("Starting value must be an allowed value.");this.value=t,this.subscribers=[]}setValue(e){return!!this.allowedValues.includes(e)&&(this.value=e,this.alertSubscribers(),!0)}}class h{constructor(){throw new ReferenceError('reference to undeclared variable "DataStore"')}static storage=new Map;static registerProvider(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return h.storage.set(e,new d(t)),[t=>{h.storage.get(e).setValue(t)},()=>h.storage.get(e)]}static registerArrayProvider(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return h.storage.set(e,new l(t)),[(t,s)=>{h.storage.get(e).setValueAtIndex(t,s)},()=>h.storage.get(e).value]}static registerEnumProvider(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t[0];return h.storage.set(e,new o(t,s)),[t=>h.storage.get(e).setValue(t),()=>h.storage.get(e).value]}static registerCombinatorProvider(e,t,s){const[r,i]=h.registerArrayProvider(e,Array(t.length).fill(0));for(let e=0;e<t.length;e++){const s=t[e];switch(h.getProviderType(s.key)){case"enum":throw new TypeError(`Unsupported Operation: Enum Providers cannot be combined. (${s.key})`);case"array":h.registerAggregateSubscriber(s.key,(t=>{r(e,t)}),s.aggregator);break;default:h.registerSubscriber(s.key,(t=>r(e,t)))}}h.storage.get(e).setDefaultAggregation(s)}static registerSubscriber(e,t){h.storage.get(e)?.subscribe(t)}static registerAggregateSubscriber(e,t,s){h.storage.get(e).subscribeAggregate(t,s)}static forceUpdate(e){h.storage.get(e)?.alertSubscribers()}static hasProvider(e){return h.storage.has(e)}static getProviderType(e){return Array.isArray(h.storage.get(e)?.value)?"array":h.storage.get(e)?.allowedValues?"enum":"standard"}}class u extends t{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(document.createElement("span")),this.element.innerText=t,this.storehouseKey=e,this.aggregate=r,this.reactiveID=s(`reactive-label-${this.storehouseKey}`)}withFormatting(e,t){return this.formatting={prepend:e,append:t},this}render(){let e=document.createElement("span");return e.id=this.reactiveID??"error",this.element.appendChild(e),this.aggregate?!0===this.aggregate?h.registerAggregateSubscriber(this.storehouseKey,this.getUpdater()):h.registerAggregateSubscriber(this.storehouseKey,this.getUpdater(),this.aggregate):h.registerSubscriber(this.storehouseKey,this.getUpdater()),this.element}getUpdater(){const e=this.reactiveID,t=this.formatting??{};return s=>{const r=document.getElementById(e),i=`${t.prepend??""}${s}${t.append??""}`;r&&(r.innerText=i)}}}class c extends t{constructor(e,t){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(),!0===s||"function"==typeof s?(!0===s&&(s=a),this.useAggregation=!0):this.useAggregation=!1,this.aggregate=s,this.label=e,this.key=t,this.meter=document.createElement("meter"),this.element.classList.add("meterContainer")}min(e){return this.meter.setAttribute("min",e),this}max(e){return this.meter.setAttribute("max",e),this}low(e){return this.meter.setAttribute("low",e),this}high(e){return this.meter.setAttribute("high",e),this}optimum(e){return this.meter.setAttribute("optimum",e),this}formatLabel(e,t){return this.prepend=e,this.append=t,this}render(){const e=new u(this.key,this.label,this.aggregate).withFormatting(this.prepend??"",this.append??"");return this.appendComponent(e),this.meter.id=`meter-${this.key}`,this.registerConsumer(this.meter),h.storage.get(this.key).alertSubscribers(),this.appendChild(this.meter),this.element}registerConsumer(e){const t=t=>{e.setAttribute("value",t?.toString())};this.useAggregation?h.registerAggregateSubscriber(this.key,t,this.aggregate):h.registerSubscriber(this.key,t)}}function p(e,t){let s=0;return s=e<180?61+63*(e-180)/360:e<541?61+88*(e-180)/360:e<631?149+20*(e-540)/360:e<721?154+28*(e-630)/360:e<901?161+24*(e-720)/360:173+28*(e-900)/360,Math.floor(s)+Math.floor(s*(t/100))}class m extends t{constructor(){super(),this.element.id="tp-display",this.perhitId=s("tp-display-per-hit"),this.to1kId=s("tp-display-to-1k")}render(){const e=new u("tp-per-hit","",!0).withFormatting(""," TP per hit ("),t=new u("tp-per-hit","",(e=>Math.ceil(1e3/p(...e)))).withFormatting(""," hits to 1000 TP)");return this.appendComponent(e),this.appendComponent(t),this.finalize()}}function g(e,t){return e*Math.max(1-t/1024,.2)}class b extends t{constructor(){super(),this.element.id="delay-display"}render(){const e=new u("modified-delay","Total Delay: ",(e=>Math.ceil(g(...e)))),t=new u("modified-delay","",(e=>(g(...e)/60).toFixed(2))).withFormatting(" ("," seconds per round)");return this.appendComponent(e),this.appendComponent(t),this.finalize()}}class f extends t{constructor(){super(),this.element.id="feedbackSidebar",this.element.classList.add("flexContainer","vertical","center","materialCard")}render(){return this.appendComponent(new b),this.appendComponent(new m),this.appendChild(document.createElement("hr")),this.appendComponent(new c("Equipment Haste","haste",f.hasteAggregator).min(0).low(250).optimum(256).high(260).max(300).formatLabel(": ","/256")),this.element}static hasteAggregator(e){return e.reduce(((e,t)=>e+10*t),0)}}class v extends t{constructor(){super(),[this.setMh,this.getMh]=h.registerProvider("delay-mh",240)}render(){this.element.classList.add("flexContainer","vertical","center");const e=document.createElement("label"),t=document.createElement("input");return t.id="main-hand-delay",e.setAttribute("for",t.id),e.innerText="Main Hand base delay",t.setAttribute("type","number"),t.setAttribute("min","1"),t.setAttribute("max","999"),t.setAttribute("value",this.getMh().value),t.addEventListener("input",(()=>this.setMh(t.valueAsNumber))),t.classList.add("smallInput"),this.appendChild(e),this.appendChild(t),this.element}}class C extends t{static SLOTS=["Main Hand","Off-Hand","Ranged","Ammo","Head","Neck","Ear 1","Ear 2","Body","Hands","Ring 1","Ring 2","Back","Waist","Legs","Feet"];constructor(e){super(document.createElement("span")),this.element.classList.add("equipment-grid"),this.dataStoreKey=e;const[t,s]=h.registerArrayProvider(this.dataStoreKey,Array(16).fill(0));this.setValue=t,this.getValue=s,this.element.id=`equipment-grid-${this.dataStoreKey}`}fieldMinimum(e){return this.fieldMinVal=e,this}fieldMaximum(e){return this.fieldMaxVal=e,this}overallMinMax(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25;return this.min=e,this.max=t,this}formatLabel(e,t){return this.prepend=e,this.append=t,this}render(){const e=this.getValue(),t=new u(this.dataStoreKey,this.dataStoreKey.replace("-"," "),!0).withFormatting(this.prepend??": ",this.append??`%/${this.max}%`);t.element.classList.add("equipPanelLabel"),this.appendComponent(t),this.appendComponent(new r);for(let t=0;t<16;t++){const s=document.createElement("span");s.classList.add("iblock"),e.push(0);let r=document.createElement("input");r.setAttribute("type","number"),r.setAttribute("data-index",`${t}`),this.fieldMinVal&&r.setAttribute("min",this.fieldMinVal),this.fieldMaxVal&&r.setAttribute("max",this.fieldMaxVal),r.addEventListener("input",this.updateListeners.bind(this)),s.appendChild(r),s.appendChild(document.createElement("br"));const i=document.createElement("span");i.classList.add("label"),i.innerText=C.SLOTS[t],s.appendChild(i),this.appendChild(s)}return setTimeout((()=>h.forceUpdate(this.dataStoreKey)),1),this.element}updateListeners(e){e.stopPropagation(),this.setValue(e.target.dataset.index,parseInt(e.target.value))}}class y extends t{constructor(){super(),this.element.id="equipmentPanel",this.element.classList.add("materialCard")}render(){return this.appendComponent(new v),this.appendComponent(new r),this.appendComponent(new C("haste").fieldMinimum(-5).fieldMaximum(26).overallMinMax(-25,26)),this.appendComponent(new C("store-tp").formatLabel(void 0,"")),this.afterRender(),this.element}afterRender(){}}const x=new class extends e{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"pageContainer";super(),this.element=document.getElementById(e)}};x.appendComponent(new n),x.appendComponent(new class extends t{constructor(){super(),this.element.id="inputPanel",this.element.classList.add("materialPanel")}render(){return this.appendComponent(new y),this.afterRender(),this.element}afterRender(){h.registerCombinatorProvider("tp-per-hit",[{key:"delay-mh"},{key:"store-tp"}],(e=>p(...e))),h.registerAggregateSubscriber("tp-per-hit",(e=>e)),h.registerCombinatorProvider("modified-delay",[{key:"delay-mh"},{key:"haste",aggregator:e=>Math.min(e.reduce(((e,t)=>e+10*t),0),256)}],(e=>g(...e)))}}),x.appendComponent(new f),x.appendComponent(new i)}()}();
//# sourceMappingURL=main.js.map